<UserControl x:Class="Hermes.Views.GestionTareasView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:viewmodels="clr-namespace:Hermes.ViewModels">

    <UserControl.DataContext>
        <viewmodels:GestionTareasViewModel/>
    </UserControl.DataContext>

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header con botones -->
        <Border Grid.Row="0" Style="{StaticResource SectionHeaderStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Gestion de Tareas"
                               Style="{StaticResource TitleTextStyle}"/>
                    <TextBlock Text="Administra las tareas del sistema"
                               Style="{StaticResource SubtitleTextStyle}"
                               Margin="0,5,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Nueva Tarea"
                            Command="{Binding AbrirNuevaTareaCommand}"
                            Style="{StaticResource SuccessButtonStyle}"
                            Margin="0,0,10,0"/>

                    <Button Content="Actualizar"
                            Command="{Binding CargarTareasCommand}"
                            Style="{StaticResource InfoButtonStyle}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- DataGrid de Tareas -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Estadisticas -->
                <Border Grid.Row="0" Style="{StaticResource InfoBannerStyle}" Margin="0,0,0,15">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Total: " FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding TotalTareas}" Foreground="{StaticResource TextPrimaryColor}" FontWeight="Bold"/>
                        <TextBlock Text="  |  Pendientes: " FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding TareasPendientes}" Foreground="{StaticResource WarningColor}" FontWeight="Bold"/>
                        <TextBlock Text="  |  Completadas: " FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding TareasCompletadas}" Foreground="{StaticResource SuccessColor}" FontWeight="Bold"/>
                        <TextBlock Text="  |  Vencidas: " FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding TareasVencidas}" Foreground="{StaticResource DangerColor}" FontWeight="Bold"/>
                    </StackPanel>
                </Border>

                <!-- Buscador -->
                <TextBox Grid.Row="1"
                         Text="{Binding FiltroTexto, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource ModernTextBoxStyle}"
                         Height="45"
                         Margin="0,0,0,15"
                         Tag="ðŸ” Buscar tareas..."/>

                <!-- DataGrid -->
                <DataGrid Grid.Row="2"
                          ItemsSource="{Binding TareasFiltradas}"
                          SelectedItem="{Binding TareaSeleccionada}"
                          Style="{StaticResource ModernDataGridStyle}"
                          ColumnHeaderStyle="{StaticResource ModernDataGridHeaderStyle}"
                          CellStyle="{StaticResource ModernDataGridCellStyle}"
                          RowStyle="{StaticResource ModernDataGridRowStyle}">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Titulo"
                                          Binding="{Binding TituloTarea}"
                                          Width="*"/>
                        <DataGridTextColumn Header="Emisor"
                                          Binding="{Binding UsuarioEmisor.Empleado.NombresEmpleado}"
                                          Width="150"/>
                        <DataGridTextColumn Header="Receptor"
                                          Binding="{Binding UsuarioReceptor.Empleado.NombresEmpleado}"
                                          Width="150"/>
                        <DataGridTextColumn Header="Estado"
                                          Binding="{Binding EstadoTarea}"
                                          Width="100"/>
                        <DataGridTextColumn Header="Prioridad"
                                          Binding="{Binding PrioridadTarea}"
                                          Width="100"/>
                        <DataGridTextColumn Header="Fecha Inicio"
                                          Binding="{Binding FechaInicioTarea, StringFormat=dd/MM/yyyy}"
                                          Width="100"/>

                        <DataGridTemplateColumn Header="Acciones" Width="320">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="Ver"
                                                Command="{Binding DataContext.VerDetalleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource CompactButtonStyle}"
                                                Background="{StaticResource InfoColor}"/>
                                        <Button Content="Editar"
                                                Command="{Binding DataContext.EditarTareaCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource CompactButtonStyle}"
                                                Background="{StaticResource WarningColor}"/>
                                        <Button Content="Eliminar"
                                                Command="{Binding DataContext.EliminarTareaCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource CompactButtonStyle}"
                                                Background="{StaticResource DangerColor}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Footer con total -->
                <Border Grid.Row="3" Style="{StaticResource InfoBannerStyle}" Margin="0,15,0,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Mostrando " FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding TareasFiltradas.Count}" Foreground="{StaticResource SuccessColor}" FontWeight="Bold"/>
                        <TextBlock Text=" de " FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding TotalTareas}" Foreground="{StaticResource InfoColor}" FontWeight="Bold"/>
                        <TextBlock Text=" tareas" FontWeight="SemiBold"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
