# Sistema HERMES - Configuración

## 📋 Descripción
Sistema de gestión inmobiliaria con autenticación de usuarios basada en roles.

## 🗄️ Configuración de Base de Datos

### Script SQL para crear la base de datos y tablas:

```sql
-- Crear base de datos
CREATE DATABASE HERMES;
GO

USE HERMES;
GO

-- Tabla EMPLEADO
CREATE TABLE EMPLEADO (
    ci_empleado INT PRIMARY KEY,
    nombres_empleado NVARCHAR(100) NOT NULL,
    apellidos_empleado NVARCHAR(100) NOT NULL,
    telefono_empleado NVARCHAR(20),
    correo_empleado NVARCHAR(320),
    es_activo_empleado BIT NOT NULL DEFAULT 1
);
GO

-- Tabla ROL
CREATE TABLE ROL (
    id_rol UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    nombre_rol NVARCHAR(50) NOT NULL,
    descripcion_rol NVARCHAR(300),
    es_activo_rol BIT NOT NULL DEFAULT 1
);
GO

-- Tabla USUARIO
CREATE TABLE USUARIO (
    id_usuario UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    empleado_ci INT NOT NULL,
    rol_id UNIQUEIDENTIFIER NOT NULL,
    nombre_usuario NVARCHAR(50) NOT NULL UNIQUE,
    password_usuario NVARCHAR(255) NOT NULL,
    es_activo_usuario BIT NOT NULL DEFAULT 1,
    CONSTRAINT FK_USUARIO_EMPLEADO FOREIGN KEY (empleado_ci) REFERENCES EMPLEADO(ci_empleado),
    CONSTRAINT FK_USUARIO_ROL FOREIGN KEY (rol_id) REFERENCES ROL(id_rol)
);
GO

-- Insertar roles predeterminados
INSERT INTO ROL (nombre_rol, descripcion_rol, es_activo_rol)
VALUES 
    ('Broker', 'Corredor de bienes raíces con acceso completo', 1),
    ('Asesor', 'Asesor de ventas', 1),
    ('Secretaria', 'Personal administrativo', 1),
    ('Administrativo', 'Personal de administración', 1);
GO

-- Insertar empleado de prueba
INSERT INTO EMPLEADO (ci_empleado, nombres_empleado, apellidos_empleado, telefono_empleado, correo_empleado, es_activo_empleado)
VALUES (12345678, 'Juan', 'Pérez', '099123456', 'juan.perez@hermes.com', 1);
GO

-- Crear usuario de prueba (contraseña: "admin123" hasheada en SHA256)
-- Hash SHA256 de "admin123": 240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9
DECLARE @RolBroker UNIQUEIDENTIFIER;
SELECT @RolBroker = id_rol FROM ROL WHERE nombre_rol = 'Broker';

INSERT INTO USUARIO (empleado_ci, rol_id, nombre_usuario, password_usuario, es_activo_usuario)
VALUES (12345678, @RolBroker, 'admin', '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9', 1);
GO
```

## 🔐 Usuario de Prueba

**CI:** 12345678  
**Contraseña:** admin123

## 🚀 Estructura Implementada

### Modelos
- ✅ `Empleado.cs` - Entidad de empleados
- ✅ `Rol.cs` - Entidad de roles
- ✅ `Usuario.cs` - Entidad de usuarios
- ✅ `RolUsuario.cs` (Enum) - Tipos de roles

### Data
- ✅ `HermesDbContext.cs` - Contexto de Entity Framework
- ✅ `DatabaseHelper.cs` - Helper de conexión

### Services
- ✅ `AutenticacionService.cs` - Servicio de autenticación con SHA256
- ✅ `UsuarioService.cs` - Servicio CRUD de usuarios
- ✅ `PropiedadService.cs`
- ✅ `ClienteService.cs`

### ViewModels
- ✅ `BaseViewModel.cs` - Clase base con INotifyPropertyChanged
- ✅ `LoginViewModel.cs` - ViewModel de login
- ✅ `UsuariosViewModel.cs` - ViewModel de gestión de usuarios
- ✅ `MainViewModel.cs`
- ✅ `PropiedadesViewModel.cs`
- ✅ `ClientesViewModel.cs`

### Views
- ✅ `LoginWindow.xaml` - Ventana de inicio de sesión
- ✅ `MainWindow.xaml` - Ventana principal
- ✅ `PropiedadesView.xaml`
- ✅ `ClientesView.xaml`
- ✅ `UsuariosView.xaml`

### Helpers
- ✅ `InverseBooleanConverter.cs` - Convertidor booleano inverso
- ✅ `StringToVisibilityConverter.cs` - Convertidor de string a visibilidad
- ✅ `ValidationHelper.cs`
- ✅ `FileHelper.cs`

### Commands
- ✅ `RelayCommand.cs` - Implementación de ICommand

## ⚙️ Configuración de Conexión

Actualiza la cadena de conexión en:
- `Data/HermesDbContext.cs`
- `Data/DatabaseHelper.cs`
- `App.config`

```
Server=PANADERO\PANCITO;Database=HERMES;Trusted_Connection=True;TrustServerCertificate=True;
```

## 📦 Paquetes NuGet Instalados

- Microsoft.EntityFrameworkCore.SqlServer (8.0.0)
- System.Configuration.ConfigurationManager (10.0.0)

## 🔄 Flujo de Autenticación

1. La aplicación inicia con `LoginWindow.xaml`
2. El usuario ingresa su CI de empleado y contraseña
3. `AutenticacionService` valida las credenciales
4. Si el usuario tiene rol "Broker", accede a `MainWindow`
5. El usuario actual se guarda en `App.UsuarioActual`

## 🛠️ Próximos Pasos

1. Ejecutar el script SQL en SQL Server
2. Verificar la cadena de conexión
3. Compilar y ejecutar la aplicación
4. Iniciar sesión con las credenciales de prueba
5. Implementar las vistas de Propiedades, Clientes y Usuarios
